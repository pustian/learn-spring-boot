<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>websocket通讯</title>
    <style>
        #message{
            margin-top:40px;
            border:1px solid gray;
            padding:20px;
        }
    </style>
    <script th:src="@{https://cdn.bootcss.com/jquery/3.3.1/jquery.js}"></script>
</head>
<body>
    <button onclick="connectWebSocket()" >连接WebSocket</button>
    <button onclick="closeWebSocket()" >断开WebSocket</button>
    <hr />
    <br />
    消息：<input id="content" type="text" />
    <button th:οnclick="|javascript:loginMsg(hello123World)|">提交</button>
    <div id="message"></div>

    <script type="text/javascript" >
        function loginMsg() {
            console.log("textContent function");
            var textContent = document.getElementById('content').value;
            console.log(textContent)
        }

        var websocket = null;
        function closeWebSocket() {
            console.log("closeWebSocket function");
            websocket.close();
        }


        function connectWebSocket() {
            // 判断当前浏览器是否支持WebSocket
            if ('WebSocket' in window) {
                websocket = new WebSocket("ws://localhost:8080/websocket");
                console.log("websocket connected")
                websocket.send("消息发送测试(From Client)");
            } else {
                alert('Not support websocket')
            }

            // 错误回调
            websocket.onerror = function () {
                setMessageInnerHTML("SOCKET ERROR,refresh");
            }

            // 成功建立连接
            websocket.onopen = function(event) {
                setMessageInnerHTML("Loc MSG: 成功建立连接");
            }

            // 接收到消息的回调
            websocket.onmessage = function(event) {
                setMessageInnerHTML(event.data);
            }

            // 连接关闭的回调方法
            websocket.onclose = function() {
                setMessageInnerHTML("Loc MSG: 关闭连接");
            }

            //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口
            // ，server端会抛异常。
            window.onbeforeunload = function() {
                websocket.close();
            }

            function setMessageInnerHTML(innerHTML) {
                document.getElementById('message').innerHTML += innerHTML + '<br/>' ;
            }
        }

    </script>
</body>
</html>